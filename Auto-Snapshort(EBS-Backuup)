#!/bin/bash #   Auto EBS Snapshot for all volumes attached to the instance
set -euo pipefail # safer bash scripting
# Prerequisites: AWS CLI configured with appropriate IAM role/permissions   

INSTANCE_ID=$(curl -s http://169.254.169.254/latest/meta-data/instance-id) # Get Instance ID    

DATE=$(date +%F) # Current date for snapshot description    

for VOL in $(aws ec2 describe-instances \  # Describe instances to get volume IDs
  --instance-ids $INSTANCE_ID \  # Use the current instance ID  
  --query "Reservations[].Instances[].BlockDeviceMappings[].Ebs.VolumeId" \    # Query to extract volume IDs            
  --output text); do    # Output as plain text

  aws ec2 create-snapshot --volume-id $VOL --description "Backup $DATE"  # Create snapshot  
  echo "Snapshot started for $VOL"  # Log message   
done  # End of loop 
echo "All snapshots initiated for instance $INSTANCE_ID"  # Completion message  
